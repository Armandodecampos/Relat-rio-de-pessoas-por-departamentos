<!DOCTYPE html>
<html>
<head>
<title>Relatórios de Pessoas e Departamentos</title>
<style>
  /* Estilos gerais */
  body {
    font-family: sans-serif;
    padding: 30px;
  }

  .conteudo {
    margin: auto;
    left: 0;
    right: 0;
    max-width: 700px;
  }

  h1, h2, h3 {
    text-align: center;
    color: #333;
  }

  p {
    margin-bottom: 10px;
  }

  label[for="fileInput"] {
    background-color: #4CAF50;
    color: white;
    padding: 10px 15px;
    border: none;
    border-radius: 0px;
    font-size: 16px;
    cursor: pointer;
    display: inline-block;
    margin-top: 10px;
    transition: background-color 0.3s ease;
  }

  label[for="fileInput"]:hover {
    background-color: #45a049;
  }

  #fileInput {
    display: none;
  }

  #fileName {
    margin-left: 10px;
    font-style: italic;
    color: #777;
  }

  button {
    padding: 10px 15px;
    margin-top: 10px;
    border: 1px solid #ccc;
    border-radius: 0px;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  #resetButton {
    background-color: #f44336;
    color: white;
    display: none; /* Inicialmente oculto */
  }

  #resetButton:hover {
    background-color: #d32f2f;
  }

  #copyPersonReportButton, #copyDepartmentReportButton, #copySpecialReportButton, #copySergioVezzaReportButton {
    background-color: #008CBA;
    color: white;
    display: none; /* Inicialmente oculto */
    margin-right: 10px;
    margin-top: 10px;
  }

  #copyPersonReportButton:hover, #copyDepartmentReportButton:hover, #copySpecialReportButton:hover, #copySergioVezzaReportButton:hover {
    background-color: #005f73;
  }

  #searchInput {
    padding: 10px;
    margin-top: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 16px;
    cursor: text;
    width: 300px;
    display: none; /* Inicialmente oculto */
    margin-right: 10px;
  }

  /* Estilos para o relatório de pessoas */
 #relatorioPessoas {
  margin-top: 20px;
  display: none; /* Inicialmente oculto */
  font-size: 18px;
  padding: 15px;
  border: 1px solid #eee;
  border-radius: 8px;
  background-color: #f9f9f9;
  max-height: 500px;
  overflow-y: auto; /* Habilita rolagem vertical */
  border:5px solid #000;
}

  #relatorioPessoas p {
    margin-bottom: 10px;
  }

  #relatorioPessoas strong {
    font-weight: bold;
  }

  #listaUltimosRegistros {
    margin-top: 10px;
    border: 1px solid #ccc;
    padding: 10px;
    border-radius: 5px;
    font-size: 16px;
  }

  #listaUltimosRegistros div {
    margin-bottom: 5px;
    word-break: break-word; /* Quebra palavras longas */
    border: 2px solid #000; /* Adiciona a borda */
    padding: 8px; /* Adiciona um pouco de espaço interno para a borda não ficar colada no texto */
    border-radius: 5px; /* Opcional: para deixar a borda com cantos arredondados */
  }

  .saida {
    background-color: #ffb4b4; /* Vermelho claro */
  }

  .entrada {
    background-color: #fff; /* Verde claro */
  }

  /* Estilos para o relatório de departamentos */
  #relatorioDepartamentos {
    margin-top: 20px;
    display: none; /* Inicialmente oculto */
  }

  #tabelaRelatorioDepartamentos1, #tabelaRelatorioDepartamentos2, #tabelaRelatorioDepartamentos3 {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
  }

  #tabelaRelatorioDepartamentos1 th, #tabelaRelatorioDepartamentos1 td,
  #tabelaRelatorioDepartamentos2 th, #tabelaRelatorioDepartamentos2 td,
  #tabelaRelatorioDepartamentos3 th, #tabelaRelatorioDepartamentos3 td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: left;
  }

  #tabelaRelatorioDepartamentos1 th, #tabelaRelatorioDepartamentos2 th, #tabelaRelatorioDepartamentos3 th {
    background-color: #f2f2f2;
    font-weight: bold;
  }

  #tabelaRelatorioDepartamentos1 tfoot th, #tabelaRelatorioDepartamentos1 tfoot td,
  #tabelaRelatorioDepartamentos2 tfoot th, #tabelaRelatorioDepartamentos2 tfoot td,
  #tabelaRelatorioDepartamentos3 tfoot th, #tabelaRelatorioDepartamentos3 tfoot td {
    font-weight: bold;
    background-color: #eee;
  }

  #relatorio1, #relatorio2, #relatorio3 {
    display: none; /* Removido, pois já está definido em #relatorioDepartamentos > h3 e table */
  }

  #searchInput {
    padding: 10px;
    margin-top: 10px;
    border: 2px solid #222;
    border-radius: 50px;
    font-size: 22px;
    cursor: text;
    width: 300px;
    display: inline-block;
    margin-right: 10px;
    box-sizing: border-box;
    text-align: center;
  }

  #searchInput:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
  }

  #searchInput::placeholder {
    font-size: 22px;
    color: #777;
    font-style: italic;
  }

  .legenda {
    margin-top: 10px;
    font-size: 14px;
    color: #555;
  }

  .legenda span {
    display: inline-block;
    width: 15px;
    height: 15px;
    border: 1px solid #ccc;
    margin-right: 5px;
    vertical-align: middle;
  }

  .legenda .entrada-cor {
    background-color: #fff;
  }

  .legenda .saida-cor {
    background-color: #ffb4b4;
  }

  /* Estilos para o relatório Sergio Vezza */
  #relatorioSergioVezza {
    margin-top: 20px;
    display: none;
  }

  #tabelaRelatorioSergioVezza {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
  }

  #tabelaRelatorioSergioVezza th, #tabelaRelatorioSergioVezza td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: left;
  }

  #tabelaRelatorioSergioVezza th {
    background-color: #f2f2f2;
    font-weight: bold;
  }

  #tabelaRelatorioSergioVezza tfoot th, #tabelaRelatorioSergioVezza tfoot td {
    font-weight: bold;
    background-color: #eee;
  }
</style>
</head>
<body>
<div class="conteudo">
<h1>Relatórios de Pessoas e Departamentos</h1>
<p>Selecione o arquivo Excel (.xlsx)</p>
<label for="fileInput">Escolher Arquivo</label>
<span id="fileName">Nenhum arquivo selecionado</span>
<input type="file" id="fileInput">
<br>

<div id="relatorioDepartamentos">
  <h2>Relatório de Departamentos</h2>
  <h3>Relatório de Departamentos Inicial</h3>
  <table id="tabelaRelatorioDepartamentos1">
    <thead>
      <tr>
        <th>Departamento</th>
        <th>Quantidade</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
    <tfoot>
      <tr>
        <th>Total</th>
        <th id="totalRelatorioDepartamentos1">0</th>
      </tr>
    </tfoot>
  </table>

  <h3>Relatório de departamentos para o Global (Rafael) ás 9h30</h3>
  <table id="tabelaRelatorioDepartamentos2">
    <thead>
      <tr>
        <th>Departamento</th>
        <th>Quantidade</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
    <tfoot>
      <tr>
        <th>Total</th>
        <th id="totalRelatorioDepartamentos2">0</th>
      </tr>
    </tfoot>
  </table>

  <h3>Relatório de departamentos para o BEES (Patrick) ás 16h00</h3>
  <table id="tabelaRelatorioDepartamentos3">
    <thead>
      <tr>
        <th>Departamento</th>
        <th>Quantidade</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
    <tfoot>
      <tr>
        <th>Total</th>
        <th id="totalRelatorioDepartamentos3">0</th>
      </tr>
    </tfoot>
  </table>
  <button id="copyDepartmentReportButton" onclick="copyDepartmentReportAsTable()">Copiar Relatório de Departamentos</button>
  <button id="copySpecialReportButton" onclick="copySpecialReportAsTable()">Copiar Relatório Especial</button>
</div>

<button id="resetButton" onclick="resetPage()">Remover Arquivo e Relatórios</button>

<div id="relatorioPessoas">
  <h2>Relatório de pessoas que entraram e sairam do prédio</h2>
  <p>Pessoas que entraram: <span id="pessoasNoPredio">0</span></p>
  <p>Pessoas que sairam: <span id="pessoasQueSairam">0</span></p>
  <p><strong>Total de pessoas: <span id="totalPessoas">0</span></strong></p>
  <br>
  <div>
    <input type="text" id="searchInput" placeholder="Pesquisar nos registros...">
  </div>
  <br>
  <div class="legenda">
    Legenda:
    Pessoas que entraram: <span class="entrada-cor"></span>
    Pessoas que sairam: <span class="saida-cor"></span>
  </div>
  <br>
  <div id="listaUltimosRegistros">
    <h3>Últimos Registros por ID Pessoal (Dados Completos):</h3>
    <div id="ultimosRegistrosLista"></div>
  </div>
</div>

<div id="relatorioSergioVezza">
  <h2>Relatório de pessoas do departamento "Sergio Vezza" para o BEES (Patrick) ás 9h30</h2>
  <table id="tabelaRelatorioSergioVezza">
    <thead>
      <tr>
        <th>Total de Pessoas: <span id="totalRelatorioSergioVezza">0</span></th>
      </tr>
    </thead>
    <tbody>
    </tbody>
    <tfoot>
      <tr>
        <th></th>
      </tr>
    </tfoot>
  </table>
  <button id="copySergioVezzaReportButton" onclick="copySergioVezzaReportAsTable()">Copiar Relatório Sergio Vezza</button>
  <button id="downloadSergioVezzaReportButton" onclick="downloadSergioVezzaReportAsExcel()">Baixar Relatório Sergio Vezza (Excel)</button>
</div>
</div>
<script src="https://unpkg.com/xlsx/xlsx.js"></script>
<script>
  const fileInput = document.getElementById('fileInput');
  const fileNameSpan = document.getElementById('fileName');
  const relatorioPessoasDiv = document.getElementById('relatorioPessoas');
  const pessoasNoPredioSpan = document.getElementById('pessoasNoPredio');
  const pessoasQueSairamSpan = document.getElementById('pessoasQueSairam');
  const totalPessoasSpan = document.getElementById('totalPessoas');
  const listaUltimosRegistrosDiv = document.getElementById('listaUltimosRegistros');
  const ultimosRegistrosLista = document.getElementById('ultimosRegistrosLista');
  const searchInput = document.getElementById('searchInput');

  const relatorioDepartamentosDiv = document.getElementById('relatorioDepartamentos');
  const tabelaRelatorioDepartamentos1Body = document.querySelector('#tabelaRelatorioDepartamentos1 tbody');
  const totalRelatorioDepartamentos1 = document.getElementById('totalRelatorioDepartamentos1');
  const tabelaRelatorioDepartamentos2Body = document.querySelector('#tabelaRelatorioDepartamentos2 tbody');
  const totalRelatorioDepartamentos2 = document.getElementById('totalRelatorioDepartamentos2');
  const tabelaRelatorioDepartamentos3Body = document.querySelector('#tabelaRelatorioDepartamentos3 tbody');
  const totalRelatorioDepartamentos3 = document.getElementById('totalRelatorioDepartamentos3');

  const relatorioSergioVezzaDiv = document.getElementById('relatorioSergioVezza');
  const tabelaRelatorioSergioVezzaBody = document.querySelector('#tabelaRelatorioSergioVezza tbody');
  const totalRelatorioSergioVezza = document.getElementById('totalRelatorioSergioVezza');

  const resetButton = document.getElementById('resetButton');
  const copyDepartmentReportButton = document.getElementById('copyDepartmentReportButton');
  const copySpecialReportButton = document.getElementById('copySpecialReportButton');
  const copySergioVezzaReportButton = document.getElementById('copySergioVezzaReportButton');

  let todosUltimosRegistros = [];

  fileInput.addEventListener('change', handleFile);
  fileInput.addEventListener('change', updateFileName);
  searchInput.addEventListener('input', handleSearch);

  // Inicialmente, os relatórios e botões estão ocultos
  resetButton.style.display = 'none';
  relatorioPessoasDiv.style.display = 'none';
  relatorioDepartamentosDiv.style.display = 'none';
  relatorioSergioVezzaDiv.style.display = 'none';
  copyDepartmentReportButton.style.display = 'none';
  copySpecialReportButton.style.display = 'none';
  copySergioVezzaReportButton.style.display = 'none';
  searchInput.style.display = 'none';

  function updateFileName() {
    if (fileInput.files.length > 0) {
      fileNameSpan.textContent = fileInput.files[0].name;
    } else {
      fileNameSpan.textContent = 'Nenhum arquivo selecionado';
      resetAllReports();
    }
  }

  function handleFile(e) {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function (event) {
        const data = new Uint8Array(event.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const sheetName = workbook.SheetNames[0];
        const worksheet = workbook.Sheets[sheetName];
        const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, defval: '' });

        processarDados(jsonData);
        resetButton.style.display = 'inline-block';
      };
      reader.readAsArrayBuffer(file);
    }
  }

  function processarDados(data) {
    // Processar relatório de pessoas
    const ultimoRegistroPorId = {};
    const header = data[0] || [];

    for (let i = 1; i < data.length; i++) { // Começar da segunda linha (após o cabeçalho)
      const linha = data[i];
      const idPessoal = linha[6];
      const dataHoraStr = linha[1];
      const status = linha[3];
      const entradaSaidaColunaD = linha[3]; // Coluna D (índice 3)

      if (idPessoal !== undefined && idPessoal !== '') {
        if (dataHoraStr !== undefined && status !== undefined) {
          const dataHora = new Date(dataHoraStr);
          if (!isNaN(dataHora.getTime())) {
            if (!ultimoRegistroPorId[idPessoal] || dataHora > ultimoRegistroPorId[idPessoal].dataHora) {
              ultimoRegistroPorId[idPessoal] = {
                dataHora: dataHora,
                status: status ? status.toLowerCase() : '',
                entradaSaidaColunaD: entradaSaidaColunaD ? entradaSaidaColunaD.toLowerCase() : '',
                linha: linha
              };
            }
          }
        }
      }
    }

    todosUltimosRegistros = [];
    ultimosRegistrosLista.innerHTML = '';
    const pessoasNoPredio = new Set();
    const pessoasQueSairam = new Set();

    for (const idPessoal in ultimoRegistroPorId) {
      if (ultimoRegistroPorId.hasOwnProperty(idPessoal)) {
        const ultimoRegistro = ultimoRegistroPorId[idPessoal];
        const status = ultimoRegistro.status;
        const entradaSaidaColunaD = ultimoRegistro.entradaSaidaColunaD;
        const linhaDados = ultimoRegistro.linha;
        let registroTexto = `ID: ${idPessoal}, Status: ${status}`;
        const registroDiv = document.createElement('div');
        registroDiv.style.border = '2px solid #000';
        registroDiv.style.padding = '8px';
        registroDiv.style.borderRadius = '5px';
        registroDiv.style.marginBottom = '5px';

        for (let j = 0; j < linhaDados.length; j++) {
          if (linhaDados[j] !== undefined && linhaDados[j] !== '') {
            const colunaNome = header[j] || `Coluna ${j + 1}`;
            let valor = linhaDados[j];
            if (j === 6 || j === 7 || j === 8) { // Colunas G (índice 6), H (índice 7), I (índice 8)
              valor = `<strong>${valor}</strong>`;
            }
            registroTexto += `, ${colunaNome}: ${valor}`;
          }
        }
        registroDiv.innerHTML = registroTexto;

        const isEntrada = entradaSaidaColunaD === 'entrada';
        const isSaidaColunaD = entradaSaidaColunaD === 'facial.elev.blb02sa' ||
          entradaSaidaColunaD === 'facial.elev.2ss-said' ||
          entradaSaidaColunaD === 'facial.elev.blb.02' ||
          entradaSaidaColunaD === 'facial.elev.bla.02';
        const isSaidaStatus = status.includes('saida') || status.includes('sáida');

        if (isSaidaColunaD || isSaidaStatus) {
          registroDiv.classList.add('saida');
          pessoasQueSairam.add(idPessoal);
        } else if (isEntrada) {
          registroDiv.classList.add('entrada');
          pessoasNoPredio.add(idPessoal);
        } else if (!isSaidaStatus) { // Se não for saída pelo status, consideramos entrada (padrão)
          registroDiv.classList.add('entrada');
          pessoasNoPredio.add(idPessoal);
        }

        ultimosRegistrosLista.appendChild(registroDiv);
        todosUltimosRegistros.push({ div: registroDiv, texto: registroTexto.toLowerCase() });
      }
    }

    pessoasNoPredioSpan.textContent = pessoasNoPredio.size;
    pessoasQueSairamSpan.textContent = pessoasQueSairam.size;
    totalPessoasSpan.textContent = pessoasNoPredio.size + pessoasQueSairam.size;
    relatorioPessoasDiv.style.display = 'block';
    searchInput.style.display = 'inline-block';

    // Processar relatório de departamentos
    gerarRelatorioDepartamentos(data);
    gerarRelatorioEspecial(data);
    relatorioDepartamentosDiv.style.display = 'block';
    copyDepartmentReportButton.style.display = 'inline-block';
    copySpecialReportButton.style.display = 'inline-block';

    // Processar relatório Sergio Vezza
    gerarRelatorioSergioVezza(data);
    relatorioSergioVezzaDiv.style.display = 'block';
    copySergioVezzaReportButton.style.display = 'inline-block';
  }

  function gerarRelatorioDepartamentos(data) {
    const departamentosInicial = {};
    const departamentosAtualizado = {};
    const idsProcessadosDepartamentos = new Set();
    const header = data[0] || [];
    const modificacoes = { // Aqui sseraõ os departamentos agrupados ou não.
      "Visitantes": "Visitante",
      "Ab-inbev": "AGT",
      "Prestador de Serviços": "Prestador de Serviços",
      "CDD Campinas": "CDD",
      "Camila Murakawa": "AGT",
      "Felipe Aragão": "AGT",
      "Gabriel Filipecki": "AGT",
      "Luis Veronesi": "AGT",
      "Rafael Pacini": "AGT",
      "Sonia Fuscaldi": "AGT",
      "Sergio Vezza": "GROWTH",
      "Fabio Mazza": "AGT",
      "Ronaldo Fiorito": "AGT",
      "Marcelo Rentz": "AGT",
      "Goran Djuric": "AGT",
      "AC": "Visitante",
      "CSC": "CSC",
      "Carlos Nobre": "AGT",
      "Fernando Leite de Campos": "AGT",
      "Mauricio Nogueira Soufen": "AGT",
      "Alexandre Van Wonterghem": "AGT",
      "Keith Davies": "AGT",
      "Lojista - Feirinha": "Visitante",
      "Terceiros Growth": "GROWTH",
      "Tech": "GROWTH",
      "Growth Group": "GROWTH",
    };

    for (let i = 2; i < data.length; i++) {
      const linha = data[i];
      const idPessoal = linha[6];
      let nomeDepartamento = linha[11];

      if (idPessoal !== undefined && idPessoal !== '' && !idsProcessadosDepartamentos.has(idPessoal)) {
        if (nomeDepartamento === '') {
          nomeDepartamento = 'Portaria virtual';
        }
        if (nomeDepartamento) {
          departamentosInicial[nomeDepartamento] = (departamentosInicial[nomeDepartamento] || 0) + 1;
        }

        let departamentoAtualizadoNome = nomeDepartamento;
        if (departamentoAtualizadoNome in modificacoes) {
          departamentoAtualizadoNome = modificacoes[departamentoAtualizadoNome];
        }
        if (departamentoAtualizadoNome) {
          departamentosAtualizado[departamentoAtualizadoNome] = (departamentosAtualizado[departamentoAtualizadoNome] || 0) + 1;
        }
        idsProcessadosDepartamentos.add(idPessoal);
      }
    }

    // Relatório 1 - Inicial (só o que tiver nos dados)
    atualizarTabelaDepartamentos(departamentosInicial, tabelaRelatorioDepartamentos1Body, totalRelatorioDepartamentos1);

    // Relatório 2 - Atualizado (força todos os departamentos da lista)
    atualizarTabelaDepartamentos(departamentosAtualizado, tabelaRelatorioDepartamentos2Body, totalRelatorioDepartamentos2, departamentosEsperadosAtualizado);
  }

  function gerarRelatorioEspecial(data) {
    const departamentosEspeciais = {};
    const idsProcessadosDepartamentos = new Set();
    const header = data[0] || [];
    const departamentosInteresse = ["Sergio Vezza", "CDD Campinas", "Terceiros Growth", "Tech", "Growth Group"];

    for (let i = 2; i < data.length; i++) {
      const linha = data[i];
      const idPessoal = linha[6];
      let nomeDepartamento = linha[11];

      if (idPessoal !== undefined && idPessoal !== '' && !idsProcessadosDepartamentos.has(idPessoal)) {
        if (nomeDepartamento && departamentosInteresse.includes(nomeDepartamento)) {
          departamentosEspeciais[nomeDepartamento] = (departamentosEspeciais[nomeDepartamento] || 0) + 1;
          idsProcessadosDepartamentos.add(idPessoal);
        }
      }
    }

    atualizarTabelaDepartamentos(departamentosEspeciais, tabelaRelatorioDepartamentos3Body, totalRelatorioDepartamentos3, departamentosEsperadosEspecial);
  }

  function gerarRelatorioSergioVezza(data) {
    const pessoasSergioVezza = new Set();
    const header = data[0] || [];

    for (let i = 1; i < data.length; i++) {
      const linha = data[i];
      const nome = linha[7];
      const sobrenome = linha[8];
      const departamento = linha[11];

      if (departamento === 'Sergio Vezza' && nome && sobrenome) {
        pessoasSergioVezza.add(`${nome} ${sobrenome}`);
      }
    }

    atualizarTabelaSergioVezza(pessoasSergioVezza);
  }

  const departamentosEsperadosInicial = []; // Aqui só serão exibidos os departamentos para o Rafael.
  const departamentosEsperadosAtualizado = [
    "AGT", "CDD", "CSC", "GROWTH", "Portaria virtual",
    "Prestador de Serviços", "Visitante"
  ];
  const departamentosEsperadosEspecial = [ // Aqui só serão exibidos os departamentos para o Patrick.
    "CDD Campinas", "Sergio Vezza", "Terceiros Growth",
    "Tech",
    "Growth Group"
  ];

  function atualizarTabelaDepartamentos(dados, tabelaBody, totalElement, listaDepartamentosEsperados = null) {
    tabelaBody.innerHTML = '';
    let total = 0;

    let dadosParaUsar = dados;

    if (listaDepartamentosEsperados) {
      dadosParaUsar = {};
      listaDepartamentosEsperados.forEach(dep => {
        dadosParaUsar[dep] = dados[dep] || 0;
      });
    }

    for (const departamento in dadosParaUsar) {
      const quantidade = dadosParaUsar[departamento];
      const row = tabelaBody.insertRow();
      const departamentoCell = row.insertCell();
      const quantidadeCell = row.insertCell();
      departamentoCell.textContent = departamento;
      quantidadeCell.textContent = quantidade;
      total += quantidade;
    }

    totalElement.textContent = total;
  }

  function atualizarTabelaSergioVezza(pessoas) {
    tabelaRelatorioSergioVezzaBody.innerHTML = '';
    let total = pessoas.size; // Obtém o total de pessoas do Set

    // Atualiza o cabeçalho da tabela
    const headerRow = document.querySelector('#tabelaRelatorioSergioVezza thead tr');
    headerRow.innerHTML = `<th>Total de Pessoas: <span id="totalRelatorioSergioVezza">${total}</span></th>`;

    const nomesOrdenados = Array.from(pessoas).sort(function (a, b) {
      return a.localeCompare(b, undefined, { sensitivity: 'base' });
    });

    nomesOrdenados.forEach(pessoa => {
      const row = tabelaRelatorioSergioVezzaBody.insertRow();
      const nomeCompletoCell = row.insertCell();
      nomeCompletoCell.textContent = pessoa;
    });

    // Remove a segunda coluna do cabeçalho, se existir
    if (headerRow.cells.length > 1) {
      headerRow.deleteCell(1);
    }

    // Limpa o corpo do rodapé
    const footerRow = document.querySelector('#tabelaRelatorioSergioVezza tfoot tr');
    if (footerRow) {
      footerRow.innerHTML = '<th></th>'; // Garante que só tenha uma célula vazia
    }
  }

  function handleSearch() {
    const termoPesquisa = searchInput.value.toLowerCase();
    todosUltimosRegistros.forEach(registro => {
      if (registro.texto.includes(termoPesquisa)) {
        registro.div.style.display = ''; // Mostra o registro
      } else {
        registro.div.style.display = 'none'; // Oculta o registro
      }
    });
  }

  function resetPage() {
    fileInput.value = ''; // Limpa o arquivo selecionado
    fileNameSpan.textContent = 'Nenhum arquivo selecionado'; // Reseta o nome do arquivo
    resetAllReports(); // Limpa os relatórios de pessoas e departamentos
    resetButton.style.display = 'none'; // Oculta o botão de reset
    relatorioPessoasDiv.style.display = 'none'; // Oculta o relatório de pessoas
    relatorioDepartamentosDiv.style.display = 'none'; // Oculta o relatório de departamentos
    relatorioSergioVezzaDiv.style.display = 'none'; // Oculta o relatório Sergio Vezza
    copyDepartmentReportButton.style.display = 'none'; // Oculta o botão de copiar do departamento
    copySpecialReportButton.style.display = 'none';
    copySergioVezzaReportButton.style.display = 'none';
    searchInput.style.display = 'none'; // Oculta o campo de pesquisa
    searchInput.value = ''; // Limpa o campo de pesquisa
    todosUltimosRegistros = []; // Limpa o array de registros de pessoas
  }

  function resetAllReports() {
    // Reseta relatório de pessoas
    pessoasNoPredioSpan.textContent = '0';
    pessoasQueSairamSpan.textContent = '0';
    totalPessoasSpan.textContent = '0';
    ultimosRegistrosLista.innerHTML = '';
    todosUltimosRegistros = [];

    // Reseta relatório de departamentos
    tabelaRelatorioDepartamentos1Body.innerHTML = '';
    totalRelatorioDepartamentos1.textContent = '0';
    tabelaRelatorioDepartamentos2Body.innerHTML = '';
    totalRelatorioDepartamentos2.textContent = '0';
    tabelaRelatorioDepartamentos3Body.innerHTML = '';
    totalRelatorioDepartamentos3.textContent = '0';

    // Reseta relatório Sergio Vezza
    tabelaRelatorioSergioVezzaBody.innerHTML = '';
    totalRelatorioSergioVezza.textContent = '0';
  }

  function copyDepartmentReportAsTable() {
    const tabela = document.getElementById('tabelaRelatorioDepartamentos2');
    let textoParaCopiar = "";

    // Adiciona as linhas do corpo
    const rows = tabela.querySelectorAll('tbody tr');
    rows.forEach(row => {
      const departamentoCell = row.querySelector('td:first-child');
      const quantidadeCell = row.querySelector('td:last-child');
      if (departamentoCell && quantidadeCell) {
        textoParaCopiar += `${departamentoCell.textContent.trim()} = ${quantidadeCell.textContent.trim()}\n`;
      }
    });

    // Adiciona a linha total
    const totalRow = tabela.querySelector('tfoot tr');
    if (totalRow) {
      const totalLabelCell = totalRow.querySelector('th:first-child');
      const totalValueCell = totalRow.querySelector('th:last-child');
      if (totalLabelCell && totalValueCell) {
        textoParaCopiar += `${totalLabelCell.textContent.trim()} = ${totalValueCell.textContent.trim()}`;
      }
    }

    // Tenta copiar para a área de transferência
    navigator.clipboard.writeText(textoParaCopiar)
      .then(() => {
        // Copiado com sucesso (sem alerta)
      })
      .catch(err => {
        console.error('Falha ao copiar o relatório de departamentos: ', err);
        // Falha ao copiar (sem alerta)
      });
  }

  function copySpecialReportAsTable() {
    const tabela = document.getElementById('tabelaRelatorioDepartamentos3');
    let textoParaCopiar = "";

    // Adiciona as linhas do corpo
    const rows = tabela.querySelectorAll('tbody tr');
    rows.forEach(row => {
      const departamentoCell = row.querySelector('td:first-child');
      const quantidadeCell = row.querySelector('td:last-child');
      if (departamentoCell && quantidadeCell) {
        textoParaCopiar += `${departamentoCell.textContent.trim()} = ${quantidadeCell.textContent.trim()}\n`;
      }
    });

    // Adiciona a linha total
    const totalRow = tabela.querySelector('tfoot tr');
    if (totalRow) {
      const totalLabelCell = totalRow.querySelector('th:first-child');
      const totalValueCell = totalRow.querySelector('th:last-child');
      if (totalLabelCell && totalValueCell) {
        textoParaCopiar += `${totalLabelCell.textContent.trim()} = ${totalValueCell.textContent.trim()}`;
      }
    }

    // Tenta copiar para a área de transferência
    navigator.clipboard.writeText(textoParaCopiar)
      .then(() => {
        // Copiado com sucesso (sem alerta)
      })
      .catch(err => {
        console.error('Falha ao copiar o relatório especial: ', err);
        // Falha ao copiar (sem alerta)
      });
  }

  function atualizarTabelaSergioVezza(pessoas) {
    tabelaRelatorioSergioVezzaBody.innerHTML = '';
    let total = pessoas.size; // Obtém o total de pessoas do Set

    // Atualiza o cabeçalho da tabela
    const headerRow = document.querySelector('#tabelaRelatorioSergioVezza thead tr');
    headerRow.innerHTML = `<th>Total de Pessoas: <span id="totalRelatorioSergioVezza">${total}</span></th>`;

    const nomesOrdenados = Array.from(pessoas).sort(function (a, b) {
      return a.localeCompare(b, undefined, { sensitivity: 'base' });
    });

    nomesOrdenados.forEach(pessoa => {
      const row = tabelaRelatorioSergioVezzaBody.insertRow();
      const nomeCompletoCell = row.insertCell();
      nomeCompletoCell.textContent = pessoa;
    });

    // Remove a segunda coluna do cabeçalho, se existir
    if (headerRow.cells.length > 1) {
      headerRow.deleteCell(1);
    }

    // Limpa o corpo do rodapé
    const footerRow = document.querySelector('#tabelaRelatorioSergioVezza tfoot tr');
    if (footerRow) {
      footerRow.innerHTML = '<th></th>'; // Garante que só tenha uma célula vazia
    }
  }
  function copySergioVezzaReportAsTable() {
    const tabela = document.getElementById('tabelaRelatorioSergioVezza');
    let textoParaCopiar = "";
    const nomesCompletos = [];

    const rows = tabela.querySelectorAll('tbody tr');
    rows.forEach(row => {
      const nomeCompletoCell = row.querySelector('td:first-child');
      if (nomeCompletoCell) {
        nomesCompletos.push(nomeCompletoCell.textContent.trim());
      }
    });

    nomesCompletos.sort(function (a, b) {
      return a.localeCompare(b, undefined, { sensitivity: 'base' });
    });

    nomesCompletos.forEach(nomeCompleto => {
      textoParaCopiar += `${nomeCompleto}\n`;
    });

    const totalRow = tabela.querySelector('tfoot tr');
    if (totalRow && totalRow.cells.length > 0) {
      textoParaCopiar += `${totalRow.cells[0].textContent}`;
    }

    navigator.clipboard.writeText(textoParaCopiar)
      .then(() => {
      })
      .catch(err => {
        console.error('Falha ao copiar o relatório Sergio Vezza: ', err);
      });
  }

  function downloadSergioVezzaReportAsExcel() {
  const tabela = document.getElementById('tabelaRelatorioSergioVezza');
  const wb = XLSX.utils.table_to_book(tabela, { sheet: "Relatório Sergio Vezza" });
  XLSX.writeFile(wb, "Relatorio_Sergio_Vezza.xlsx");
  }
</script>
</body>
</html>